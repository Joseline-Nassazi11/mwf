doctype html
html(lang="en")
  head
    meta(charset="UTF-8")
    meta(name="viewport" content="width=device-width, initial-scale=1.0")
    title Dashboard
    link(rel="stylesheet", href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css")
    link(rel="stylesheet", href="/css/dashboard.css")
    script(src="https://cdn.jsdelivr.net/npm/chart.js")

  body
    nav.navbar.navbar-expand-lg.navbar-dark.bg-dark.mb-4
      .container-fluid
        //- a.navbar-brand(href="/dashboard") Dashboard
        button.navbar-toggler(type="button", data-bs-toggle="collapse", data-bs-target="#navbarNav")
          span.navbar-toggler-icon
        #navbarNav.collapse.navbar-collapse
          ul.navbar-nav.ms-auto
            li.nav-item
              a.nav-link(href="/stocklist") Stock List
            li.nav-item
              a.nav-link(href="/stock") Add Stock

    .container
      h1.mb-4.text-center Dashboard Overview

      // Stats Cards
      .row.mb-4
        .col-md-4
          .card.text-white.bg-primary.mb-3
            .card-header Total Expenses
            .card-body
              h5.card-title #{totalExpenseFormatted}
              p.card-text Total cost of stock purchased

        .col-md-4
          .card.text-white.bg-success.mb-3
            .card-header Total Revenue
            .card-body
              h5.card-title #{totalRevenueFormatted}
              p.card-text Total sales revenue

        .col-md-4
          .card.text-white.bg-warning.mb-3
            .card-header Total Profit
            .card-body
              h5.card-title #{totalProfitFormatted}
              p.card-text Revenue minus Expenses

      // Expenses & Revenues by Product Type
      .row.mb-4
        .col-md-6
          .card.mb-3
            .card-header Expenses by Product
            .card-body
              table.table.table-striped
                thead
                  tr
                    th Product Type
                    th Quantity
                    th Total Cost
                tbody
                  each value, key in expenseMap
                    tr
                      td #{key}
                      td #{value.totalQuantity}
                      td #{new Intl.NumberFormat("en-UG", { style: "currency", currency: "UGX" }).format(value.totalCost)}

        .col-md-6
          .card.mb-3
            .card-header Revenues by Product
            .card-body
              table.table.table-striped
                thead
                  tr
                    th Product Type
                    th Quantity
                    th Total Revenue
                tbody
                  each value, key in revenueMap
                    tr
                      td #{key}
                      td #{value.totalQuantity}
                      td #{new Intl.NumberFormat("en-UG", { style: "currency", currency: "UGX" }).format(value.totalRevenue)}

      // Chart
      .row.mb-4
        .col-12
          .card
            .card-header Sales Chart
            .card-body
              canvas#salesChart(width="400" height="150")

      script.
        const ctx = document.getElementById('salesChart').getContext('2d');
        const salesChart = new Chart(ctx, {
          type: 'line',
          data: {
            labels: !{chartLabels},
            datasets: [{
              label: 'Monthly Sales',
              data: !{chartData},
              backgroundColor: 'rgba(54, 162, 235, 0.2)',
              borderColor: 'rgba(54, 162, 235, 1)',
              borderWidth: 2,
              fill: true
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: { display: true },
              title: { display: true, text: 'Monthly Sales Chart' }
            }
          }
        });
