doctype html
html(lang="en")
  head
    meta(charset="UTF-8")
    meta(name="viewport" content="width=device-width, initial-scale=1.0")
    title MWF - Sales Records
    link(href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet")
    link(rel="stylesheet" href="/css/stock-table.css")
    link(rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css")
  body
    // Navbar
    .navbar-custom.d-flex.justify-content-between.align-items-center.p-2.bg-success
      .d-flex.align-items-center
        img(src="/images/mwf-logo.png" alt="MWF Logo" class="logo")
        span.ms-2.fw-bold.text-white Mayondo Wood & Furniture Ltd
      ul.navbar-nav.ms-auto
        li.nav-item
          a.nav-link(href="/dashboard") Dashboard    
        li.nav-item
          a.nav-link(href="/agent-dashboard") Attendant Dashboard     
      span.user-role.text-white Attendant

    // Sales Table
    .content.container.mt-4
      .card.p-4.shadow
        // The D-Flex container for the aligned header and small, right-aligned button
        .d-flex.justify-content-between.align-items-center.mb-3
          h4.mb-0 Sales Records
          a.btn.btn-success.btn-sm(href="/Addsale")
            i.bi.bi-plus-lg.me-1
            | Add Sale
        table.table.table-striped.table-hover.mt-3
          thead.table-header-green
            tr
              th #
              th Customer
              th Product
              th Unit Price
              th Quantity
              th Total Price
              th Payment Type
              th Transport
              th Agent
              th Date
              if currentUser && currentUser.role === 'Manager'
                th Actions
              else  
                th Actions
          tbody
            if sales.length
              each sale, index in sales
                tr
                  td #{index + 1}
                  td #{sale.customerName}
                  //- td #{sale.product.}
                  //- td #{sale.product && sale.product.name ? sale.product.name : 'N/A'}
                  td #{sale.product ? sale.product.name : 'N/A'}
                  td #{sale.unitPrice.toLocaleString()}
                  td #{sale.quantity}
                  td #{sale.totalPrice.toLocaleString()}
                  td #{sale.paymentType}
                  td #{sale.transport ? 'Yes' : 'No'}
                  td #{sale.agent && sale.agent.fullName ? sale.agent.fullName : 'N/A'}
                  td #{moment(sale.date).format('YYYY-MM-DD')}
                  if currentUser.role === 'Manager'
                    td
                      // Edit button
                      a.btn.btn-warning.btn-sm(href=`/editsales/${sale._id}`) Edit
                      // Delete form
                      form(action=`/deletesales/${sale._id}` method="POST" style="display:inline")
                        button.btn.btn-danger.btn-sm(type="submit" onclick="return confirm('Are you sure you want to delete this sale?')") Delete
                  else
                     td
                      .btn-group
                        a.btn.btn-dark.mt-3(href=`/sales/${sale._id}/receipt`) Receipt
                        //- a.btn.btn-sm.btn-info.me-1(href="/Addsale") Add
            else
              tr
                td(colspan="11").text-center.text-muted No sales recorded yet
